<!DOCTYPE html>
<html>

<head>
    <title>Sélection des dates</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        .form-date-arrivee-depart {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-date-arrivee-depart input {
            width: 150px;
            padding: 5px;
            margin: 0 10px;
        }

        #calendar {
            display: none;
            margin: 20px auto;
            max-width: 600px;
        }

        .selected-range {
            background-color: #ccc;
        }
    </style>
</head>

<body>
    <div class="form-date-arrivee-depart">
        <input type="text" name="arrivee" id="date-arrive" placeholder="Date d'arrivée">
        <input type="text" name="depart" id="date-depart" placeholder="Date de départ">
    </div>
    <div id="calendar"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            var arrivalDate;
            var departureDate;

            $('#date-arrive').click(function () {
                $('#calendar').show();
                arrivalDate = null;
                departureDate = null;
                $('.selected-arrival').removeClass('selected-arrival');
                $('.selected-departure').removeClass('selected-departure');
                $('.selected-range').removeClass('selected-range');
            });

            $('#date-depart').click(function () {
                if (arrivalDate) {
                    $('#calendar').show();
                    $('.selected-arrival').removeClass('selected-arrival');
                    $('.selected-departure').removeClass('selected-departure');
                    $('.selected-range').removeClass('selected-range');
                }
            });

            $('#date-arrive').datepicker({
                dateFormat: 'yy-mm-dd',
                minDate: 0,
                onSelect: function (selectedDate) {
                    arrivalDate = moment(selectedDate, 'YYYY-MM-DD');
                    $('#date-arrive').val(arrivalDate.format('YYYY-MM-DD'));
                    if (departureDate && arrivalDate.isAfter(departureDate)) {
                        $('#date-depart').val('');
                        departureDate = null;
                    }
                    updateCalendar();
                }
            });

            $('#date-depart').datepicker({
                dateFormat: 'yy-mm-dd',
                minDate: 0,
                onSelect: function (selectedDate) {
                    departureDate = moment(selectedDate, 'YYYY-MM-DD');
                    $('#date-depart').val(departureDate.format('YYYY-MM-DD'));
                    updateCalendar();
                    $('#calendar').hide();
                }
            });

            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next',
                    center: 'title',
                    right: 'month,agendaWeek'
                },
                defaultView: 'month',
                selectable: true,
                select: function (start, end) {
                    if (!arrivalDate) {
                        arrivalDate = moment(start);
                        $('#date-arrive').val(arrivalDate.format('YYYY-MM-DD'));
                    } else if (!departureDate) {
                        departureDate = moment(start);
                        $('#date-depart').val(departureDate.format('YYYY-MM-DD'));
                        updateCalendar();
                        $('#calendar').hide();
                    }
                },
                dayRender: function (date, cell) {
                    if (arrivalDate && !departureDate && date.isSame(arrivalDate)) {
                        cell.addClass('selected-arrival');
                    } else if (departureDate && date.isSame(departureDate)) {
                        cell.addClass('selected-departure');
                    } else if (arrivalDate && departureDate && date.isBetween(arrivalDate, departureDate, 'day', '[]')) {
                        cell.addClass('selected-range');
                    }
                },
                unselect: function () {
                    arrivalDate = null;
                    departureDate = null;

                    $('.selected-arrival').removeClass('selected-arrival');
                    $('.selected-departure').removeClass('selected-departure');
                    $('.selected-range').removeClass('selected-range');

                    $('#calendar').hide();
                },
                events: []
            });

            function updateCalendar() {
                $('.selected-range').removeClass('selected-range');

                if (arrivalDate && departureDate) {
                    var currentDate = moment(arrivalDate);
                    while (currentDate.isBefore(departureDate) || currentDate.isSame(departureDate)) {
                        var dateCell = $('.fc-day[data-date="' + currentDate.format('YYYY-MM-DD') + '"]');
                        dateCell.addClass('selected-range');
                        currentDate.add(1, 'day');
                    }
                }
            }
        });
    </script>
</body>

</html>